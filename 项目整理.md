# 总览

- 现有召回路（按照订单转化率倒序排序）：
  - TagRecallAnuual：tag年周期召回
  - Repurchase：复购召回
  - TagRecallRepurchase：tag近期复购召回
  - historySearchRecall：历史搜索召回
  - Similar：相似召回**（其点击率较高）**
  - tag：tag实时搜索召回
  - CB：长短期兴趣召回
  - userModelCategory：用户二级品类模型召回
  - hot：热门召回
  - deepWalkRecall：deepwalk召回
  - BoutiqueReplace
  - AdProduct：
  - ItemCF：协同过滤召回
  - ColdStartRecall：冷启动召回
  - StoreOpWindow：
  - Market：

# 一、召回

## 1.1 历史搜索召回

- 项目背景：
- 召回思路
- 线上实验效果

## 1.2 tag召回

- 项目背景：
- 召回思路
- 线上实验效果

## 1.3 用户二级品类召回

- 项目背景
- 召回思路
- 线上实验效果

## 1.4 tag年周期召回

- 项目背景：在推荐首页瀑布流新增一路tag粒度召回，用于召回当前活跃用户在一年前同起购买记录的同tag商品。

- 召回思路：一年前用户购买过的tag召回

  - 用户与tag关联数据：目标日期天数+3（超参数A），作为基准点，计算基准点一年前的日期，前后15（超参数B）天的用户购买记录，获取用户的购买tag列表

  - 用户过滤：全量用户数据量太大，只取当前日期前推30天（超参数C）活跃的用户过滤，可以覆盖召回目标日期中，一年前有购买记录的用户且在当天活跃的用户比例为94%

  - 运营区域过滤：由于各个区域同一个tag售卖的商品不一样，需要对用户指定售卖区域，过去30天（超参数C）内，用户活跃区域只有一个的占比为93%，取过去用户30天内活跃天数最多的区域作为用户的目标区域

  - tag间排序：根据tag购买记录距离目标日期的时间间隔、购买量、gmv总和排序，得到tag间的排序。
    $$
    score=DiffWeight*DateDiff + GMVWeight*GMV
    $$

  - tag内商品排序：根据tag所属商品的价格，与用户一年前购买的tag内商品的价格差，与商品的cvr、gmv均值联合排序。价格差由商品价格和该tag下商品的平均价格进行计算。

  - 多样性优化：单个二级品类内限制tag数量（超参数D），根据tag间排序截断。限制二级品类最大数量（超参数E），由二级品类内的tag均分

  - 召回上限截断：召回上限为150（超参数F），每一路召回最大100，放宽到150作为商品过滤的buffer，tag间使用z字排序取商品

- 线上实验效果

  - 首页瀑布流：GMV提升**4.081%**，qty提升**2.235%**，uv购买转化率提升**1.982%**，人均加购次数提升**1.457%**
  - 分类页推荐：GMV提升**3.8294%**，qty提升**2.3255%**，uv购买转化率提升**0.8864%**，人均加购次数提升**0.92%**
  - 猜你喜欢：GMV提升**3.318%**，qty提升**1.766%**，uv购买转化率提升**1.035%**，人均加购数提升**0.7666%**
  - 推荐所有：GMV提升**2.6176%**，qty提升**1.3643%**，人均加购次数提升**1.3354%**
  - 平台：GMV提升**0.0078%**，qty提升**0.09%**，uv购买转化率提升**0.136%**
  - 多样性：全平台人均点击二级品类数提升 **1.3589%**

## 1.5 tag近期复购召回

- 项目背景
- 召回思路：用户过去90天（超参数A）tag购买记录，与tag复购周期的匹配
  - 计算复购周期：统计过去一年间tag购买记录的时间周期，过滤异常值，对复购时间进行标准化，左偏高斯分布处理，计算每个时间间隔复购的概率值，总和为1
  - 获取用户与tag的购买时间间隔：获取用户过去90天（超参数A）的购买记录，获取tag最近购买记录与目标天的时间间隔
  - 获取用户的tag复购概率：与第一步的复购周期匹配，获取用户在每个tag上的复购概率，作为tag排序
  - 运营区域过滤：获取用户过去90天（超参数A）所属的运营区域，召回商品与运营区域匹配
  - tag间排序：以复购概率排序
  - tag内商品排序：同一个商品排序最高，其他按照商品价格差、cvr、gmv总和排序
  - 多样性优化与召回上限截断：与年周期召回一致
- 线上实验效果
  - 首页瀑布流：GMV提升**6.198%**，qty提升**4.668%**，uv购买转化率提升**3.155%**，人均加购次数提升**1.699%**
  - 分类页推荐：GMV提升**4.371%**，qty提升**1.447%**，uv购买转化率提升**1.469%**，人均加购次数提升**0.981%**
  - 猜你喜欢：GMV提升**4.893%**，qty提升**4.33%**，uv购买转化率提升**2.821%**，人均加购数提升**2.035%**
  - 推荐所有：GMV提升**4.426%**，qty提升**3.299%**，人均加购次数提升**1.557%**
  - 平台：GMV提升**0.361%**，qty提升**0.318%**，uv购买转化率提升**0.027%**
  - 多样性：推荐所有——核心人均曝光不同二级品类数 **0.487%**，核心人均点击不同二级品类数 **1.119%**，核心曝光二级品类基尼系数 **0.854%**

## 1.6 CB向量召回

- 项目背景
- 召回思路
- 线上实验效果

# 二、粗排





# 三、线上服务







# 四、数据

## 4.1 实验相关

- 实验主要场景
  - 新版首页
  - 分类页推荐
  - 猜你喜欢（包括新老购物车页、个人中心、商品详情页、支付成功页）
  - 平台
  - 推荐所有（包括首页、分类页推荐、猜你喜欢）
  - 相似商品
  - 商详页搭配一起买
  - 分享落地页
  - 凑单推荐
- 相关指标
  - GMV：商品销售总额
  - qty：商品份数
  - 订单人数：order_uv
  - 子订单数：sub_order
  - 订单数：order
  - uv购买转化率：
  - 单价gmv
  - 人均点击次数
  - 人均不去重点击次数
  - 人均加购次数
  - 人均不去重加购次数
  - 人均点击加购次数
  - 人均不去重点击加购次数
  - 客单价
  - 核心人均曝光卡片数
  - 核心人均曝光不同skusn数
  - 核心人均曝光不同二级品类数
  - 核心曝光skusn商品基尼系数
  - 核心曝光二级品类基尼系数：
    - 基尼系数：国际上通用的，用以衡量一个国家或地区居民收入差距的常用指标。基尼系数介于0-1之间，基尼系数越大，表示不平等程度越高
    - 计算方式：A / (A+B)
    - 推广：按照类目的**流行度（曝光次数）**从大到小排序后进行统计后进行洛伦茨曲线的绘制。基尼系数越大代表所有类目的分布越不均匀，系数越小代表类目分布越均匀。
  - 核心人均点击卡片数
  - 核心人均点击不同skusn数
  - 核心人均加购数
  - 核心人均点击不同二级品类数
  - 曝光pv
  - 曝光uv
  - 点击pv
  - 点击uv
  - 加购pv
  - 加购uv
  - pv点击率
  - uv点击率
  - pv加购率
  - uv加购率
  - 平均曝光位置
  - 平均点击位置
  - 平均加购位置
